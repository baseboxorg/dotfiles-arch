#!/usr/bin/env bash

# default behavior is to bring up a new random wallpaper.
# wal-set --useprev will attempt to persist cached colors,
# which is useful in .xinitrc or if something happens and
# you just want to reload stuff.

notify-send "[wal-set] init" -t 1

WALLP="${HOME}/Wallpapers/optimized-1920x1080"

if [[ "$1" == "--useprev" ]] && \
   [[ -f "${HOME}/.cache/wal/wal" ]]; then
    WALLP="$(< "${HOME}/.cache/wal/wal")"
fi

wal -i "$WALLP" -a 75
xrdb -merge "${HOME}/.Xresources"

# reload stuff, or start in the case of being called in .xinitrc the first time
pkill dunst
pkill polybar
pkill compton

. "${HOME}/.cache/wal/colors.sh"

bspc config normal_border_color "$color0"
bspc config focused_border_color "$color5"
dunst \
    -lb "$color0"  \
    -nb "$color0"  \
    -cb "#ff0000"  \
    -lf "$color15" \
    -bf "$color15" \
    -cf "#000000"  \
    -nf "$color15" &

polybar top & polybar bottom &
compton --config "${HOME}/.config/compton/compton.conf" &

notify-send "[wal-set] done" -t 1
